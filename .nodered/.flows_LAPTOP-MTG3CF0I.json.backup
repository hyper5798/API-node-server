[{"id":"4ac75a69.1f9464","type":"tab","label":"流程1","disabled":false,"info":""},{"id":"a8678817.da38b8","type":"mqtt-broker","z":"","name":"本機MQTT","broker":"127.0.0.1","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"699566ee.639e58","type":"websocket-listener","z":"","path":"/test","wholemsg":"false"},{"id":"39987c42.9fdcc4","type":"mqtt-broker","z":"","name":"花蓮poc","broker":"161.202.32.59","port":"1883","clientid":"","usetls":false,"compatmode":false,"keepalive":"60","cleansession":true,"birthTopic":"","birthQos":"0","birthPayload":"","closeTopic":"","closeQos":"0","closePayload":"","willTopic":"","willQos":"0","willPayload":""},{"id":"73f5c5f8.36e95c","type":"mqtt in","z":"4ac75a69.1f9464","name":"YESIO/DL/CONTROLL","topic":"YESIO/DL/CONTROLL","qos":"2","datatype":"auto","broker":"39987c42.9fdcc4","x":200,"y":180,"wires":[["87ca0ced.8bb4c"]]},{"id":"b0bdde45.5448c","type":"mqtt out","z":"4ac75a69.1f9464","name":"YESIO/DL/CONTROLL","topic":"YESIO/DL/CONTROLL","qos":"","retain":"","broker":"39987c42.9fdcc4","x":490,"y":120,"wires":[]},{"id":"e21a39b.c5919c8","type":"websocket in","z":"4ac75a69.1f9464","name":"","server":"699566ee.639e58","client":"","x":160,"y":40,"wires":[["fd3d9c35.fdd48"]]},{"id":"ff626883.fd31b8","type":"websocket out","z":"4ac75a69.1f9464","name":"","server":"699566ee.639e58","client":"","x":360,"y":400,"wires":[]},{"id":"87ca0ced.8bb4c","type":"debug","z":"4ac75a69.1f9464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":410,"y":180,"wires":[]},{"id":"600a6a31.e459e4","type":"function","z":"4ac75a69.1f9464","name":"","func":"let obj = msg.payload\nlet mac = obj.id\nlet cmd = obj.v.cmd\n//node.error(cmd)\nif(context.global.mac === undefined)\n    context.global.mac = []\nif(cmd === 'connection'){\n    //context.global.mac.push(mac)\n    node.error(\"Node-red websocket connection\")\n    return\n} else if(cmd === 'open')\n    msg.payload =  {\"macAddr\": mac, \"data\": \"open\"}\nelse if(cmd === 'close') \n    msg.payload =  {\"macAddr\": mac, \"data\": \"close\"}\nreturn msg","outputs":1,"noerr":0,"x":290,"y":120,"wires":[["b0bdde45.5448c","360fabbc.7440b4"]]},{"id":"fd3d9c35.fdd48","type":"json","z":"4ac75a69.1f9464","name":"","property":"payload","action":"","pretty":false,"x":170,"y":120,"wires":[["600a6a31.e459e4"]]},{"id":"961e9816.bc22c8","type":"mqtt in","z":"4ac75a69.1f9464","name":"YESIO/UL/REPORT","topic":"YESIO/UL/REPORT","qos":"2","datatype":"auto","broker":"a8678817.da38b8","x":190,"y":340,"wires":[["102faedf.fb7f01"]]},{"id":"4b7eee0.2506a14","type":"mqtt out","z":"4ac75a69.1f9464","name":":YESIO/UL/REPORT","topic":"YESIO/UL/REPORT","qos":"","retain":"","broker":"a8678817.da38b8","x":420,"y":280,"wires":[]},{"id":"d776da8b.e85348","type":"inject","z":"4ac75a69.1f9464","name":"","topic":"","payload":"{\"macAddr\":\"012345678934\",\"data\":{\"temperature\":20,\"humidity\":35},\"frameCnt\":\"2\",\"fport\":\"1\"}","payloadType":"str","repeat":"","crontab":"","once":false,"onceDelay":0.1,"x":170,"y":280,"wires":[["4b7eee0.2506a14"]]},{"id":"a8dc9cf6.92a64","type":"function","z":"4ac75a69.1f9464","name":"","func":"let obj = msg.payload\nlet mac = obj.macAddr\nlet data = obj.data\nmsg.payload = {\"id\": mac, \"v\": {\"data\":data}}\nreturn msg;","outputs":1,"noerr":0,"x":171,"y":400,"wires":[["ff626883.fd31b8","fbf55886.107848"]]},{"id":"102faedf.fb7f01","type":"json","z":"4ac75a69.1f9464","name":"","property":"payload","action":"","pretty":false,"x":350,"y":340,"wires":[["a8dc9cf6.92a64"]]},{"id":"fbf55886.107848","type":"debug","z":"4ac75a69.1f9464","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":380,"y":460,"wires":[]},{"id":"360fabbc.7440b4","type":"debug","z":"4ac75a69.1f9464","name":"","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","x":480,"y":60,"wires":[]}]